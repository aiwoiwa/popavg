<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>rate</title>

    <link rel="icon" href="src/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="src/apple-touch-icon.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sanitize.css/2.0.0/sanitize.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vue-slider-component@latest/theme/default.css">
    <link rel="stylesheet" href="style/style.css">

    <script type="text/x-template" id="v-accordion-grid-tbody-template">
        <tbody>
            <tr class="pointer"
                @click='toggle()'>
                <td class='center'>{{ item.ver }}</td>
                <td class='left'>
                    {{ item.genre ?? item.song }}
                    <span class='UPPER' v-if='item.isUPPER'>(UPPER)</span>
                    <span :class='item.difficulty'>{{ `(${item.difficulty})` }}</span>
                </td>
                <td class='right rate percent'>{{ item.pf_rate }}</td>
                <td class='right rate percent'>{{ item.fc_rate }}</td>
                <td class='right rate percent'>{{ item.clear_rate }}</td>
                <td class='right rate'>{{ item.top_score }}</td>
                <td :class="['center',
                               item.top_medal >= 10 ? 'perfect'
                             : item.top_medal >=  7 ? 'fullCombo'
                             : item.top_medal >=  4 ? 'clear'
                             : item.top_medal >=  3 ? 'easy'
                             : item.top_medal >=  0 ? 'failed'
                             : 'no-play']">
                    {{
                        ~[10, 9, 6, 2].indexOf(item.top_medal) ? '★'
                      : ~[    8, 5, 1].indexOf(item.top_medal) ? '◆'
                      : ~[    7, 4, 0].indexOf(item.top_medal) ? '●'
                      : ~[       3   ].indexOf(item.top_medal) ? 'EASY'
                      : 'NO PLAY'
                    }}
                </td>
                <td>
                    <span :class="['icon', {'active': isOpened}]">
                        <span class="icon-line"></span>
                        <span class="icon-line"></span>
                    </span>
                </td>
            </tr>
            <tr>
                <td colspan='8'
                    class='no-padding'>
                    <transition name="js-accordion"
                                @before-enter="beforeEnter"
                                @enter="enter"
                                @before-leave="beforeLeave"
                                @leave="leave">
                        <div v-if='isOpened'
                             class='js-accordion-target'>
                            <canvas :id="`canvas-pie-medal-${item.id}`"></canvas>
                            <canvas :id="`canvas-pie-score-${item.id}`"></canvas>
                            <canvas :id="`canvas-line-${item.id}`"></canvas>
                        </div>
                    </transition>
                </td>
            </tr>
        </tbody>
    </script>
    <script type="text/x-template" id="v-accordion-grid-template">
        <table class="accordion-grid">
            <thead>
                <tr>
                    <th @click="sortBy('ver_order')"
                        :class="['indicator',
                                 'width10',
                                 'center',
                                 sortOrders['ver_order'] > 0 ? 'asc' : 'desc',
                                 {active: sortKey==='ver_order'}]">
                        Ver
                    </th>
                    <th @click="sortBy('genre')"
                        :class="['indicator',
                                 'width35',
                                 'center',
                                 sortOrders['genre'] > 0 ? 'asc' : 'desc',
                                 {active: sortKey==='genre'}]">
                        Title
                    </th>
                    <th title="no bad & no good"
                        @click="sortBy('pf_rate')"
                        :class="['indicator',
                                 'width10',
                                 'center',
                                 'rate',
                                 sortOrders['pf_rate'] > 0 ? 'asc' : 'desc',
                                 {active: sortKey==='pf_rate'}]">
                        PF
                    </th>
                    <th title="no bad"
                        @click="sortBy('fc_rate')"
                        :class="['indicator',
                                 'width10',
                                 'center',
                                 'rate',
                                 sortOrders['fc_rate'] > 0 ? 'asc' : 'desc',
                                 {active: sortKey==='fc_rate'}]">
                        FC
                    </th>
                    <th @click="sortBy('clear_rate')"
                        :class="['indicator',
                                 'width10',
                                 'center',
                                 'rate',
                                 sortOrders['clear_rate'] > 0 ? 'asc' : 'desc',
                                 {active: sortKey==='clear_rate'}]">
                        Clear
                    </th>
                    <th @click="sortBy('top_score')"
                        :class="['indicator',
                                 'width10',
                                 'center',
                                 'rate',
                                 sortOrders['top_score'] > 0 ? 'asc' : 'desc',
                                 {active: sortKey==='top_score'}]">
                        Top<br/>Score
                    </th>
                    <th @click="sortBy('top_medal')"
                        :class="['indicator',
                                 'width10',
                                 'center',
                                 sortOrders['top_medal'] > 0 ? 'asc' : 'desc',
                                 {active: sortKey==='top_medal'}]">
                        Top<br/>Medal
                    </th>
                    <th class='width5'></th>
                </tr>
            </thead>
            <tbody is="v-accordion-grid-tbody"
                   v-for="item in sortedItems"
                   :key="`item_${item.id}`"
                   :item="item">
            </tbody>
            <tfoot>
                <td class="right"
                    :colspan='8'>
                    最終更新日:2021/01/08 00:05:47
                </td>
            </tfoot>
        </table>
    </script>
</head>
<body>
    <div id="app" class="center">
        <table>
            <tr>
                <th>Range</th>
                <td :class="['width100', 'pClass-selector']">
                    <vue-slider class="pClass-slider"
                                ref="pClassSlider"
                                v-model="selector"
                                :data="pClassesForVueSlider"
                                :marks="marks"
                                :process="process"
                                :adsorb="true"
                                :tooltip="'always'"
                                :tooltip-placement="['top', 'bottom']"
                                @change="changePClass()">
                        <template v-slot:step="{label, active}">
                            <div :class="['custom-step', {active}]">
                            </div>
                        </template>
                    </vue-slider>
                </td>
            </tr>
        </table>
        <table>
            <tr>
                <th>Lv</th>
                <template v-for="item in dataSrcKeys">
                    <td @click="getData(item)"
                        :class="['dataSrc-selector',
                                 {active: selectedDataSrcKey===item}]">
                        {{ item }}
                    </td>
                </template>
            </tr>
        </table>
        <v-accordion-grid :items="gridItems"
                          :columns="gridColumns">
        </v-accordion-grid>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-slider-component@3.2.11/dist/vue-slider-component.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="index.js"></script>
</body>
</html>